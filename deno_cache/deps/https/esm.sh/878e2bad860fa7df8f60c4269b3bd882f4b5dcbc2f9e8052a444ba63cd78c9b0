/* esm.sh - esbuild bundle(lib0@0.2.74/broadcastchannel) deno production */
import __Process$ from "https://deno.land/std@0.177.0/node/process.ts";import  { Buffer as __Buffer$ } from "https://deno.land/std@0.177.0/node/buffer.ts";var c=()=>new Map;var C=(e,t,o)=>{let r=e.get(t);return r===void 0&&e.set(t,r=o()),r};var b=()=>new Set;var A=String.fromCharCode,W=String.fromCodePoint,R=e=>e.toLowerCase(),I=/^\s*/g,N=e=>e.replace(I,""),_=/([A-Z])/g,l=(e,t)=>N(e.replace(_,o=>`${t}${R(o)}`));var X=typeof TextEncoder<"u"?new TextEncoder:null;var i=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});i&&i.decode(new Uint8Array).length===1&&(i=null);var u=e=>e===void 0?null:e;var p=class{constructor(){this.map=new Map}setItem(t,o){this.map.set(t,o)}getItem(t){return this.map.get(t)}},B=new p,d=!0;try{typeof localStorage<"u"&&(B=localStorage,d=!1)}catch{}var a=B,v=e=>d||addEventListener("storage",e),L=e=>d||removeEventListener("storage",e);var E=(e,t)=>t.includes(e);var s=typeof __Process$<"u"&&__Process$.release&&/node|io\.js/.test(__Process$.release.name),y=typeof document<"u"&&typeof document<"u"&&!s,ee=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,n,z=[],D=()=>{if(n===void 0)if(s){n=c();let e=__Process$.argv,t=null;for(let o=0;o<e.length;o++){let r=e[o];r[0]==="-"?(t!==null&&n.set(t,""),t=r):t!==null?(n.set(t,r),t=null):z.push(r)}t!==null&&n.set(t,"")}else typeof location=="object"?(n=c(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,o]=e.split("=");n.set(`--${l(t,"-")}`,o),n.set(`-${l(t,"-")}`,o)}})):n=c();return n},g=e=>D().has(e);var m=e=>s?u(__Process$.env[e.toUpperCase()]):u(a.getItem(e));var $=e=>g("--"+e)||m(e)!==null,te=$("production"),O=s&&E(__Process$.env.FORCE_COLOR,["true","1","2"]),oe=!g("no-colors")&&(!s||__Process$.stdout.isTTY||O)&&(!s||g("color")||O||m("COLORTERM")!==null||(m("TERM")||"").includes("color"));var Y=e=>new Uint8Array(e);var T=e=>new Uint8Array(e),Z=e=>{let t="";for(let o=0;o<e.byteLength;o++)t+=A(e[o]);return btoa(t)},G=e=>__Buffer$.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),H=e=>{let t=atob(e),o=Y(t.length);for(let r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return o},J=e=>{let t=__Buffer$.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},k=y?Z:G,M=y?H:J;var P=new Map,h=class{constructor(t){this.room=t,this.onmessage=null,this._onChange=o=>o.key===t&&this.onmessage!==null&&this.onmessage({data:M(o.newValue||"")}),v(this._onChange)}postMessage(t){a.setItem(this.room,k(T(t)))}close(){L(this._onChange)}},Q=typeof BroadcastChannel>"u"?h:BroadcastChannel,x=e=>C(P,e,()=>{let t=b(),o=new Q(e);return o.onmessage=r=>t.forEach(f=>f(r.data,"broadcastchannel")),{bc:o,subs:t}}),re=(e,t)=>(x(e).subs.add(t),t),ne=(e,t)=>{let o=x(e),r=o.subs.delete(t);return r&&o.subs.size===0&&(o.bc.close(),P.delete(e)),r},se=(e,t,o=null)=>{let r=x(e);r.bc.postMessage(t),r.subs.forEach(f=>f(t,o))};export{se as publish,re as subscribe,ne as unsubscribe};
//# sourceMappingURL=broadcastchannel.js.map