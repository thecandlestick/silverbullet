/* esm.sh - esbuild bundle(@codemirror/lang-markdown@6.1.0) deno production */
import{EditorSelection as L,Prec as F}from"@codemirror/state";import{keymap as T}from"@codemirror/view";import{defineLanguageFacet as R,foldNodeProp as X,indentNodeProp as H,languageDataProp as K,foldService as V,syntaxTree as B,Language as $,LanguageDescription as P,ParseContext as j,LanguageSupport as v}from"@codemirror/language";import{parser as G,GFM as Q,Subscript as z,Superscript as J,Emoji as U,MarkdownParser as Y,parseCode as Z}from"@lezer/markdown";import{html as _}from"/v119/@codemirror/lang-html@6.4.3/X-ZS9AQGNvZGVtaXJyb3IvbGFuZy1odG1sLEBjb2RlbWlycm9yL2xhbmd1YWdlLEBjb2RlbWlycm9yL3N0YXRlLEBjb2RlbWlycm9yL3ZpZXcsQGxlemVyL2NvbW1vbixAbGV6ZXIvaGlnaGxpZ2h0LEBsZXplci9tYXJrZG93bg/deno/lang-html.mjs";import{NodeProp as W}from"@lezer/common";var M=R({block:{open:"<!--",close:"-->"}}),E=new W,N=G.configure({props:[X.add(t=>!t.is("Block")||t.is("Document")||b(t)!=null?void 0:(f,r)=>({from:r.doc.lineAt(f.from).to,to:f.to})),E.add(b),H.add({Document:()=>null}),K.add({Document:M})]});function b(t){let f=/^(?:ATX|Setext)Heading(\d)$/.exec(t.name);return f?+f[1]:void 0}function ee(t,f){let r=t;for(;;){let e=r.nextSibling,n;if(!e||(n=b(e.type))!=null&&n<=f)break;r=e}return r.to}var te=V.of((t,f,r)=>{for(let e=B(t).resolveInner(r,-1);e&&!(e.from<f);e=e.parent){let n=e.type.prop(E);if(n==null)continue;let i=ee(e,n);if(i>r)return{from:r,to:i}}return null});function S(t){return new $(M,t,[te],"markdown")}var re=S(N),ne=N.configure([Q,z,J,U]),D=S(ne);function oe(t,f){return r=>{if(r&&t){let e=null;if(r=/\S*/.exec(r)[0],typeof t=="function"?e=t(r):e=P.matchLanguageName(t,r,!0),e instanceof P)return e.support?e.support.language.parser:j.getSkippingParser(e.load());if(e)return e.parser}return f?f.parser:null}}var k=class{constructor(f,r,e,n,i,l,m){this.node=f,this.from=r,this.to=e,this.spaceBefore=n,this.spaceAfter=i,this.type=l,this.item=m}blank(f,r=!0){let e=this.spaceBefore+(this.node.name=="Blockquote"?">":"");if(f!=null){for(;e.length<f;)e+=" ";return e}else{for(let n=this.to-this.from-e.length-this.spaceAfter.length;n>0;n--)e+=" ";return e+(r?this.spaceAfter:"")}}marker(f,r){let e=this.node.name=="OrderedList"?String(+q(this.item,f)[2]+r):"";return this.spaceBefore+e+this.type+this.spaceAfter}};function O(t,f){let r=[];for(let n=t;n&&n.name!="Document";n=n.parent)(n.name=="ListItem"||n.name=="Blockquote"||n.name=="FencedCode")&&r.push(n);let e=[];for(let n=r.length-1;n>=0;n--){let i=r[n],l,m=f.lineAt(i.from),o=i.from-m.from;if(i.name=="FencedCode")e.push(new k(i,o,o,"","","",null));else if(i.name=="Blockquote"&&(l=/^[ \t]*>( ?)/.exec(m.text.slice(o))))e.push(new k(i,o,o+l[0].length,"",l[1],">",null));else if(i.name=="ListItem"&&i.parent.name=="OrderedList"&&(l=/^([ \t]*)\d+([.)])([ \t]*)/.exec(m.text.slice(o)))){let a=l[3],s=l[0].length;a.length>=4&&(a=a.slice(0,a.length-4),s-=4),e.push(new k(i.parent,o,o+s,l[1],a,l[2],i))}else if(i.name=="ListItem"&&i.parent.name=="BulletList"&&(l=/^([ \t]*)([-+*])([ \t]{1,4}\[[ xX]\])?([ \t]+)/.exec(m.text.slice(o)))){let a=l[4],s=l[0].length;a.length>4&&(a=a.slice(0,a.length-4),s-=4);let d=l[2];l[3]&&(d+=l[3].replace(/[xX]/," ")),e.push(new k(i.parent,o,o+s,l[1],a,d,i))}}return e}function q(t,f){return/^(\s*)(\d+)(?=[.)])/.exec(f.sliceString(t.from,t.from+10))}function A(t,f,r,e=0){for(let n=-1,i=t;;){if(i.name=="ListItem"){let m=q(i,f),o=+m[2];if(n>=0){if(o!=n+1)return;r.push({from:i.from+m[1].length,to:i.from+m[0].length,insert:String(n+2+e)})}n=o}let l=i.nextSibling;if(!l)break;i=l}}var le=({state:t,dispatch:f})=>{let r=B(t),{doc:e}=t,n=null,i=t.changeByRange(l=>{if(!l.empty||!D.isActiveAt(t,l.from))return n={range:l};let m=l.from,o=e.lineAt(m),a=O(r.resolveInner(m,-1),e);for(;a.length&&a[a.length-1].from>m-o.from;)a.pop();if(!a.length)return n={range:l};let s=a[a.length-1];if(s.to-s.spaceAfter.length>m-o.from)return n={range:l};let d=m>=s.to-s.spaceAfter.length&&!/\S/.test(o.text.slice(s.to));if(s.item&&d)if(s.node.firstChild.to>=m||o.from>0&&!/[^\s>]/.test(e.lineAt(o.from-1).text)){let u=a.length>1?a[a.length-2]:null,c,p="";u&&u.item?(c=o.from+u.from,p=u.marker(e,1)):c=o.from+(u?u.to:0);let w=[{from:c,to:m,insert:p}];return s.node.name=="OrderedList"&&A(s.item,e,w,-2),u&&u.node.name=="OrderedList"&&A(u.item,e,w),{range:L.cursor(c+p.length),changes:w}}else{let u="";for(let c=0,p=a.length-2;c<=p;c++)u+=a[c].blank(c<p?a[c+1].from-u.length:null,c<p);return u+=t.lineBreak,{range:L.cursor(m+u.length),changes:{from:o.from,insert:u}}}if(s.node.name=="Blockquote"&&d&&o.from){let u=e.lineAt(o.from-1),c=/>\s*$/.exec(u.text);if(c&&c.index==s.from){let p=t.changes([{from:u.from+c.index,to:u.to},{from:o.from+s.from,to:o.to}]);return{range:l.map(p),changes:p}}}let h=[];s.node.name=="OrderedList"&&A(s.item,e,h);let y=s.item&&s.item.from<o.from,g="";if(!y||/^[\s\d.)\-+*>]*/.exec(o.text)[0].length>=s.to)for(let u=0,c=a.length-1;u<=c;u++)g+=u==c&&!y?a[u].marker(e,1):a[u].blank(u<c?a[u+1].from-g.length:null);let x=m;for(;x>o.from&&/\s/.test(o.text.charAt(x-o.from-1));)x--;return g=t.lineBreak+g,h.push({from:x,to:m,insert:g}),{range:L.cursor(x+g.length),changes:h}});return n?!1:(f(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0)};function C(t){return t.name=="QuoteMark"||t.name=="ListMark"}function ie(t,f){let r=t.resolveInner(f,-1),e=f;C(r)&&(e=r.from,r=r.parent);for(let n;n=r.childBefore(e);)if(C(n))e=n.from;else if(n.name=="OrderedList"||n.name=="BulletList")r=n.lastChild,e=r.to;else break;return r}var se=({state:t,dispatch:f})=>{let r=B(t),e=null,n=t.changeByRange(i=>{let l=i.from,{doc:m}=t;if(i.empty&&D.isActiveAt(t,i.from)){let o=m.lineAt(l),a=O(ie(r,l),m);if(a.length){let s=a[a.length-1],d=s.to-s.spaceAfter.length+(s.spaceAfter?1:0);if(l-o.from>d&&!/\S/.test(o.text.slice(d,l-o.from)))return{range:L.cursor(o.from+d),changes:{from:o.from+d,to:l}};if(l-o.from==d){let h=o.from+s.from;if(s.item&&s.node.from<s.item.from&&/\S/.test(o.text.slice(s.from,s.to)))return{range:i,changes:{from:h,to:o.from+s.to,insert:s.blank(s.to-s.from)}};if(h<l)return{range:L.cursor(h),changes:{from:h,to:l}}}}}return e={range:i}});return e?!1:(f(t.update(n,{scrollIntoView:!0,userEvent:"delete"})),!0)},fe=[{key:"Enter",run:le},{key:"Backspace",run:se}],I=_({matchClosingTags:!1});function he(t={}){let{codeLanguages:f,defaultCodeLanguage:r,addKeymap:e=!0,base:{parser:n}=re}=t;if(!(n instanceof Y))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let i=t.extensions?[t.extensions]:[],l=[I.support],m;r instanceof v?(l.push(r.support),m=r.language):r&&(m=r);let o=f||m?oe(f,m):void 0;return i.push(Z({codeParser:o,htmlParser:I.language.parser})),e&&l.push(F.high(T.of(fe))),new v(S(n.configure(i)),l)}export{re as commonmarkLanguage,se as deleteMarkupBackward,le as insertNewlineContinueMarkup,he as markdown,fe as markdownKeymap,D as markdownLanguage};
//# sourceMappingURL=lang-markdown.mjs.map