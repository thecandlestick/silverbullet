(()=>{function l(t){t().catch(e=>{console.error("Caught error",e.message)})}var a=class{constructor(e,n=!0){this.print=n,this.callback=e}log(...e){this.push("log",e)}warn(...e){this.push("warn",e)}error(...e){this.push("error",e)}info(...e){this.push("info",e)}push(e,n){this.callback(e,this.logMessage(n)),this.print&&console[e](...n)}logMessage(e){let n=[];for(let r of e)switch(typeof r){case"string":case"number":n.push(""+r);break;case"undefined":n.push("undefined");break;default:try{let s=JSON.stringify(r,null,2);s.length>500&&(s=s.substring(0,500)+"..."),n.push(s)}catch{n.push("[circular object]")}}return n.join(" ")}};function d(t){let e=atob(t),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.charCodeAt(s);return r}function y(t,e){return syscall("sandboxFetch.fetch",t,e)}function u(){globalThis.fetch=async function(t,e){let n=await y(t,e&&{method:e.method,headers:e.headers,body:e.body});return new Response(n.base64Body?d(n.base64Body):null,{status:n.status,headers:n.headers})}}typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var g=new Map,i=new Map;function o(t){typeof window<"u"&&window.parent!==window?window.parent.postMessage(t,"*"):self.postMessage(t)}var c=0;self.syscall=async(t,...e)=>await new Promise((n,r)=>{c++,i.set(c,{resolve:n,reject:r}),o({type:"syscall",id:c,name:t,args:e})});var p=new Map;self.require=t=>{let e=p.get(t);if(!e)throw new Error(`Dynamically importing non-preloaded library ${t}`);return e};self.console=new a((t,e)=>{o({type:"log",level:t,message:e})},!1);function h(t){return`return (${t})["default"]`}self.addEventListener("message",t=>{l(async()=>{let e=t.data;switch(e.type){case"load":{let n=new Function(h(e.code));g.set(e.name,n()),o({type:"inited",name:e.name})}break;case"load-dependency":{let r=new Function(`return ${e.code}`)();p.set(e.name,r),o({type:"dependency-inited",name:e.name})}break;case"invoke":{let n=g.get(e.name);if(!n)throw new Error(`Function not loaded: ${e.name}`);try{let r=await Promise.resolve(n(...e.args||[]));o({type:"result",id:e.id,result:r})}catch(r){o({type:"result",id:e.id,error:r.message,stack:r.stack})}}break;case"syscall-response":{let n=e.id,r=i.get(n);if(!r)throw console.log("Current outstanding requests",i,"looking up",n),Error("Invalid request id");i.delete(n),e.error?r.reject(new Error(e.error)):r.resolve(e.result)}break}})});u();})();
//# sourceMappingURL=worker.js.map
